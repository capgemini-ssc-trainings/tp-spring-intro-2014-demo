<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:cache="http://www.springframework.org/schema/cache"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
		http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <aop:aspectj-autoproxy>
        <aop:include name="callMonitor" />
    </aop:aspectj-autoproxy>
    
    <!-- 
    	xml style aop configuration
    	- enable this part
    	- remove the aop:aspectj-autoproxy
    -->
    <!-- 
    <aop:config>
    	<aop:pointcut expression="within(@org.springframework.stereotype.Repository *)" id="callMonitoring"/>
    	<aop:aspect ref="callMonitor">
    		<aop:around method="monitor" pointcut-ref="callMonitoring"/>
    	</aop:aspect>
    </aop:config>
    -->

    <!-- 
        Call monitoring aspect that monitors call count and call invocation 
        time 
    -->
    <bean id="callMonitor"
        class="com.capgemini.ssc.training.bookdemo.aspects.CallMonitoringAspect" />

    <!-- 
        Exporter that exposes the CallMonitoringAspect via JMX, based on 
        the @ManagedResource, @ManagedAttribute, and @ManagedOperation annotations. 
    -->
    <context:mbean-export />
    
    <!-- enables scanning for @Cacheable annotation -->
    <cache:annotation-driven/>
    
     <!-- JDK ConcurrentMap based Cache -->
	 <!-- 
	 <util:set id="cacheManager">
		<bean
			class="org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean"
			p:name="default-simple" />
		<bean
			class="org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean"
			p:name="books-simple" />
	</util:set>

	<bean id="simpleCacheManager" class="org.springframework.cache.support.SimpleCacheManager"
			p:caches-ref="simpleCaches" />
	--> 

	<!-- Ehcache based Cache -->
    <bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheCacheManager">
        <property name="cacheManager" ref="ehcache"/>
    </bean>

    <bean id="ehcache" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean">
        <property name="configLocation" value="classpath:cache/ehcache.xml"/>
    </bean>
    
</beans>
